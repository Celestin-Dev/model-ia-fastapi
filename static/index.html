<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>D√©tection v√©hicules en temps r√©el</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            display: flex;
            gap: 20px;
            margin: 20px;
        }
        #video-container {
            flex: 1;
        }
        #detections-table {
            flex: 1;
            max-width: 400px;
            border-collapse: collapse;
        }
        #detections-table th, #detections-table td {
            border: 1px solid #ccc;
            padding: 8px;
        }
        #detections-table th {
            background-color: #f0f0f0;
        }
        img {
            max-width: 640px;
            height: auto;
            border: 2px solid #000;
        }
    </style>
</head>
<body>
    <div id="video-container">
        <h2>üöó Flux vid√©o</h2>
        <img id="video-frame" src="">
        <div id="fps"></div>
        <div id="vehicle-count">V√©hicules d√©tect√©s: 0</div>
    </div>

    <div id="table-container">
        <h2>üìã R√©sultats de d√©tection</h2>
        <table id="detections-table">
            <thead>
                <tr>
                    <th>Car ID</th>
                    <th>Car Score</th>
                    <th>Plaque</th>
                    <th>Plaque Score</th>
                </tr>
            </thead>
            <tbody id="table-body">
            </tbody>
        </table>
    </div>

    <script>
        // Connecter au serveur WebSocket
        const ws = new WebSocket("ws://localhost:8000/ws");

        const videoFrame = document.getElementById("video-frame");
        const fpsDisplay = document.getElementById("fps");
        const tableBody = document.getElementById("table-body");

        ws.onopen = () => {
            console.log("Connect√© au serveur WebSocket");
        };

        ws.onmessage = (event) => {
            const data = JSON.parse(event.data);

            console.log(data);
            document.getElementById("vehicle-count").textContent = `V√©hicules d√©tect√©s: ${data.total_vehicles}`;
            
            // Afficher la vid√©o
            if (data.video) {
                videoFrame.src = "data:image/jpeg;base64," + data.video;
            }

            // Afficher FPS
            fpsDisplay.innerText = `FPS: ${data.fps.toFixed(2)} | Frame: ${data.frame_nmr}`;

            // Mettre √† jour le tableau
            tableBody.innerHTML = "";
            data.detections.forEach(det => {
                const row = document.createElement("tr");

                const carIdCell = document.createElement("td");
                carIdCell.textContent = det.car_id;
                row.appendChild(carIdCell);

                const carIdCellScore = document.createElement("td");
                carIdCellScore.textContent = det.license_plate_bbox_score;
                row.appendChild(carIdCellScore);

                const plateCell = document.createElement("td");
                plateCell.textContent = det.license_number;
                row.appendChild(plateCell);

                const plateCellScore = document.createElement("td");
                plateCellScore.textContent = det.license_number_score;
                row.appendChild(plateCellScore);

                tableBody.appendChild(row);
            });
        };

        ws.onclose = () => {
            console.log("D√©connect√© du serveur WebSocket");
        };
    </script>
</body>
</html>
